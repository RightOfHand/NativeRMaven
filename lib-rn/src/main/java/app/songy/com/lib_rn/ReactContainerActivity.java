package app.songy.com.lib_rn;import android.os.Bundle;import android.support.annotation.Nullable;import android.support.v7.app.AppCompatActivity;import android.view.KeyEvent;import com.alibaba.android.arouter.facade.annotation.Route;import com.facebook.react.ReactInstanceManager;import com.facebook.react.ReactInstanceManagerBuilder;import com.facebook.react.ReactRootView;import com.facebook.react.common.LifecycleState;import com.facebook.react.devsupport.DevSupportManagerImpl;import com.facebook.react.devsupport.interfaces.DevOptionHandler;import com.facebook.react.modules.core.DefaultHardwareBackBtnHandler;import com.facebook.react.shell.MainReactPackage;import app.songy.com.lib_rn.bridge.RNConstants;import app.songy.com.lib_rn.bridge.RNBridgePackage;import app.songy.com.lib_rn.codepush.react.CodePush;import android.util.Log;/** * Description: * Created by song on 2018/9/21. * email：bjay20080613@qq.com */@Route(path = "/rn/loadView")public class ReactContainerActivity extends AppCompatActivity implements DefaultHardwareBackBtnHandler {    private static final  String TAG=ReactContainerActivity.class.getSimpleName();    private ReactRootView mReactRootView;    private ReactInstanceManager mReactInstanceManager;    private ReactInstanceManagerBuilder builder;    private String codePushServer="http://app-aliyun2.aicaitest.com:16000";    private String moduleName;    @Override    protected void onCreate(@Nullable Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        Log.d(TAG,"onCreate:"+"................");        getIntentParam();        if (moduleName==null){            return;        }        mReactRootView=new ReactRootView(this);        mReactInstanceManager = ReactInstanceManager.builder()                .setApplication(getApplication())                .setBundleAssetName("index.android.bundle")                .addPackage(new MainReactPackage())                .addPackage(new RNBridgePackage())                .addPackage(new CodePush("cAx5SdkehTn6pxOE1UuVp2JkWTCp4ksvOXqog",                getApplicationContext(),BuildConfig.DEBUG,codePushServer))                .setJSBundleFile(CodePush.getJSBundleFile())                .setUseDeveloperSupport(BuildConfig.DEBUG)                .setInitialLifecycleState(LifecycleState.RESUMED)                .build();////        mReactInstanceManager.getDevSupportManager().addCustomDevOption("调试工具", new DevOptionHandler() {//            @Override//            public void onOptionSelected() {////            }//        });        // 注意这里的moduleName必须对应“index.js”中的        // “AppRegistry.registerComponent()”的第一个参数        mReactRootView.startReactApplication(mReactInstanceManager, moduleName, null);        setContentView(mReactRootView);    }    private void getIntentParam(){        if (getIntent()!=null){            moduleName=getIntent().getStringExtra(RNConstants.RN_PARAM_MODULE_NAME);        }    }    @Override    protected void onStart() {        super.onStart();        if (mReactInstanceManager!=null){        }    }    @Override    protected void onResume() {        super.onResume();        if (mReactInstanceManager!=null){            mReactInstanceManager.onHostResume(this,this);        }    }    @Override    protected void onPause() {        super.onPause();        if (mReactInstanceManager!=null){            mReactInstanceManager.onHostPause(this);        }    }    @Override    protected void onDestroy() {        super.onDestroy();        if (mReactInstanceManager!=null){            mReactInstanceManager.onHostDestroy(this);        }        if (mReactRootView!=null){            mReactRootView.unmountReactApplication();        }    }    @Override    public void onBackPressed() {        if (mReactInstanceManager!=null){            mReactInstanceManager.onBackPressed();        }else {            super.onBackPressed();        }    }    @Override    public boolean onKeyUp(int keyCode, KeyEvent event) {        if (keyCode == KeyEvent.KEYCODE_MENU && mReactInstanceManager != null) {            mReactInstanceManager.showDevOptionsDialog();            return true;        }        return super.onKeyUp(keyCode, event);    }    @Override    public void invokeDefaultOnBackPressed() {        super.onBackPressed();    }}